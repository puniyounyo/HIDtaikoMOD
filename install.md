# HIDtaiko ver.1.2.4 導入説明書

## はじめに

この説明書では、自作の太鼓型入力デバイス「HIDtaiko」を制御するためのArduinoスケッチ「HIDtaiko ver.1.2.4」をArduino IDEに導入し、動作させるまでの手順を解説します。

## 必要なもの

* **Arduinoボード:** スケッチに対応したArduinoボード（例：Arduino Uno、Arduino Leonardoなど）。特に、`Keyboard.h`ライブラリを使用する場合は、ATmega32U4チップを搭載したボード（Leonardo、Microなど）を推奨します。Nintendo Switch制御機能を使用する場合は、それに対応したボードやライブラリの要件を確認してください。
* **Arduino IDE (Integrated Development Environment):** Arduinoボードにスケッチを書き込むためのソフトウェア。最新版を[Arduino公式サイト](https://www.arduino.cc/en/software)からダウンロードし、インストールしてください。
* **USBケーブル:** ArduinoボードとPCを接続するためのUSBケーブル。
* **関連ライブラリ:** スケッチで使用している以下のライブラリをArduino IDEにインストールする必要があります。
    * `Adafruit_GFX_Library`
    * `Adafruit_SSD1306`
    * `EEPROM` (Arduino IDEに標準で含まれている場合があります)
    * `NintendoSwitchControlLibrary` (Nintendo Switch制御機能を使用する場合)
* **HIDtaikoハードウェア:** 作成済みの太鼓型入力デバイス（センサー、ボタン、OLEDディスプレイなどがArduinoボードに適切に配線されている必要があります）。

## ライブラリのインストール手順

スケッチで使用しているライブラリをArduino IDEにインストールします。

1.  **Arduino IDEを起動します。**
2.  **「スケッチ」メニューから「ライブラリをインクルード」を選択し、「ライブラリを管理...」をクリックします。**
3.  **ライブラリマネージャの検索バーに、以下のライブラリ名を一つずつ入力して検索し、インストールします。**
    * `Adafruit GFX Library` (Adafruit Industriesによるもの)
    * `Adafruit SSD1306` (Adafruit Industriesによるもの)
    * `EEPROM` (通常はインストール不要ですが、念のため検索して存在を確認してください)
    * `NintendoSwitchControlLibrary` (Pro MicroなどのATmega32U4ベースのボードで使用する場合は、[GitHubリポジトリ](https://github.com/nicohood/NintendoSwitchControlLibrary)からダウンロードして手動でインストールする必要がある場合があります。「スケッチ」メニューから「ライブラリをインクルード」→「.ZIP形式のライブラリを追加...」を選択し、ダウンロードしたZIPファイルを指定してください。)
4.  **各ライブラリの最新バージョンが推奨されますが、特定のバージョンが必要な場合は、インストール時にバージョンを選択できます。**
5.  **すべての必要なライブラリのインストールが完了したら、ライブラリマネージャを閉じます。**

## スケッチの導入手順

1.  **この導入説明書と共に提供されたArduinoスケッチのコード（通常は `.ino` ファイル）を、Arduino IDEの新しいウィンドウにコピー＆ペーストします。**
2.  **「ファイル」メニューから「名前を付けて保存...」を選択し、適切な場所にスケッチの名前（例：`HIDtaiko`）で保存します。** Arduino IDEは、スケッチ名と同じ名前のフォルダを作成し、その中に `.ino` ファイルを保存します。

## ボードとポートの設定

Arduino IDEで、使用するArduinoボードとPCとの接続ポートを設定します。

1.  **ArduinoボードをUSBケーブルでPCに接続します。**
2.  **Arduino IDEの「ツール」メニューから「ボード」を選択し、使用しているArduinoボードのモデルを選択します。（例：「Arduino Uno」、「Arduino Leonardo」など）**
3.  **「ツール」メニューから「ポート」を選択し、接続されているArduinoボードのシリアルポートを選択します。** ポート名は環境によって異なります。（例：Windowsの場合は「COMx」、macOS/Linuxの場合は「/dev/tty.usbmodemxxxx」など）

## スケッチの書き込み

設定が完了したら、スケッチをArduinoボードに書き込みます。

1.  **Arduino IDEのツールバーにある右向きの矢印ボタン（「マイコンボードに書き込む」）をクリックします。**
2.  **Arduino IDEの下部のステータスバーに、書き込みの進捗状況が表示されます。**
3.  **書き込みが完了すると、「マイコンボードへの書き込みが完了しました。」というメッセージが表示されます。**

## 動作確認

1.  **シリアルモニタの起動:** Arduino IDEの「ツール」メニューから「シリアルモニタ」を選択します。（または、ツールバーの右端にある虫眼鏡アイコンをクリックします）
2.  **ボーレートの設定:** シリアルモニタの右下にあるドロップダウンメニューで、スケッチ内の `Serial.begin()` で設定したボーレート（通常は `115200`）と同じ値を選択します。
3.  **起動メッセージの確認:** Arduinoボードのリセットボタンを押すか、USBケーブルを抜き差しして再接続すると、シリアルモニタに起動メッセージ（「Starting...」、「PCモードを有効化します。」または「Switchモードを有効化します。」など）が表示されることを確認します。
4.  **モードの確認:** OLEDディスプレイが搭載されている場合は、ディスプレイに現在の動作モード（PC MODEまたはSW MODE）が表示されることを確認します。
5.  **入力のテスト:**
    * **PCモード:** HIDtaikoの各入力（太鼓面、ボタンなど）を操作し、シリアルモニタに反応が表示されるか、PC上でキーボード入力がエミュレートされているかを確認します。
    * **Nintendo Switchモード:** HIDtaikoの各入力を操作し、Nintendo Switch上で対応する操作が行われるか確認します。
6.  **設定モードのテスト:** PCモード時に、設定モード切り替えボタン（14番ピンに接続されたボタン）を押して、OLEDディスプレイが設定モード表示に切り替わることを確認します。数値増減ボタン（6, 7番ピン）と決定ボタン（8番ピン）を使用して、設定値を変更できること、および最終項目で決定ボタンを押すと通常モードに戻ることを確認します。
7.  **EEPROM保存の確認:** 設定モードで値を変更した後、Arduinoボードを再起動し、シリアルモニタまたはOLEDディスプレイで、変更した設定値が保持されているか確認します。

## トラブルシューティング

* **コンパイルエラー:** Arduino IDEにエラーメッセージが表示される場合は、以下の点を確認してください。
    * 必要なライブラリがすべて正しくインストールされているか。
    * スケッチのコードにタイプミスがないか。
    * 使用しているArduinoボードがスケッチの機能（特に `Keyboard.h` や `NintendoSwitchControlLibrary`）に対応しているか。
* **書き込みエラー:** スケッチをArduinoボードに書き込めない場合は、以下の点を確認してください。
    * ArduinoボードがUSBケーブルで正しくPCに接続されているか。
    * Arduino IDEで正しいボードとポートが選択されているか。
    * USBドライバが正しくインストールされているか（必要に応じて再インストールを試してください）。
* **動作しない:** 書き込みは成功したが、HIDtaikoが意図通りに動作しない場合は、以下の点を確認してください。
    * ハードウェアの配線がスケッチのピン定義と一致しているか。
    * センサーやボタンなどの入力デバイスが正常に動作しているか。
    * シリアルモニタの出力を確認し、スケッチが意図した通りの入力を認識しているか。
    * Nintendo Switchモードの場合は、Switch本体の設定やペアリングが適切に行われているか。

## その他

このスケッチはバージョン1.2.4です。将来的に新しいバージョンが公開される可能性があります。

スケッチの詳細な機能や設定については、別途提供されている「HIDtaiko ver.1.2.4 スケッチ説明書」を参照してください。
